<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Bookmarks</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: white;
        color: black;
        transition: background-color 0.3s, color 0.3s;
    }
    body.dark-mode {
        background-color: #121212;
        color: white;
    }
    h2 {
        cursor: pointer;
        margin: 10px 0;
    }
    ul {
        list-style-type: none;
        padding-left: 20px;
        display: none;
    }
    li {
        margin: 5px 0;
    }
    a {
        color: inherit;
        text-decoration: none;
    }
    a:hover {
        text-decoration: underline;
    }
    .toggle-btn {
        position: fixed;
        top: 10px;
        right: 10px;
        background: none;
        border: 1px solid currentColor;
        padding: 5px 10px;
        cursor: pointer;
        border-radius: 5px;
    }
</style>
</head>
<body>
<button class="toggle-btn" id="themeToggle">Toggle Theme</button>
<div id="bookmarks"></div>

<script>
    // Theme handling
    function applyTheme(theme) {
        document.body.classList.toggle("dark-mode", theme === "dark");
        localStorage.setItem("theme", theme);
    }

    const storedTheme = localStorage.getItem("theme");
    if (storedTheme) {
        applyTheme(storedTheme);
    } else {
        const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        applyTheme(prefersDark ? "dark" : "light");
    }

    document.getElementById("themeToggle").addEventListener("click", () => {
        const isDark = document.body.classList.contains("dark-mode");
        applyTheme(isDark ? "light" : "dark");
    });

    // Bookmarks loading
    fetch("bookmarks.json")
        .then(response => response.json())
        .then(data => {
            const bookmarksDiv = document.getElementById("bookmarks");
            
            function createSection(title, children) {
                const sectionTitle = document.createElement("h2");
                sectionTitle.textContent = title;
                const list = document.createElement("ul");
                
                sectionTitle.addEventListener("click", () => {
                    list.style.display = list.style.display === "none" ? "block" : "none";
                });

                children.forEach(child => {
                    if (child.type === "folder") {
                        const folderItem = document.createElement("li");
                        const folderTitle = document.createElement("h3");
                        folderTitle.textContent = child.name;
                        const sublist = document.createElement("ul");
                        
                        folderTitle.addEventListener("click", () => {
                            sublist.style.display = sublist.style.display === "none" ? "block" : "none";
                        });

                        child.children.forEach(subchild => {
                            const linkItem = document.createElement("li");
                            const link = document.createElement("a");
                            link.href = subchild.url;
                            link.textContent = subchild.name;
                            link.target = "_blank";
                            linkItem.appendChild(link);
                            sublist.appendChild(linkItem);
                        });

                        folderItem.appendChild(folderTitle);
                        folderItem.appendChild(sublist);
                        list.appendChild(folderItem);
                    } else if (child.type === "bookmark") {
                        const linkItem = document.createElement("li");
                        const link = document.createElement("a");
                        link.href = child.url;
                        link.textContent = child.name;
                        link.target = "_blank";
                        linkItem.appendChild(link);
                        list.appendChild(linkItem);
                    }
                });

                bookmarksDiv.appendChild(sectionTitle);
                bookmarksDiv.appendChild(list);
            }

            // Custom sorting: Toolbar and its subfolders first
            const sortedRoots = data.roots.bookmark_bar.children.sort((a, b) => {
                if (a.name.toLowerCase() === "toolbar") return -1;
                if (b.name.toLowerCase() === "toolbar") return 1;
                if (a.type === "folder" && b.type !== "folder") return -1;
                if (a.type !== "folder" && b.type === "folder") return 1;
                return a.name.localeCompare(b.name);
            });

            // Create sections from bookmark_bar first
            createSection("Toolbar", sortedRoots);

            // Create sections from other roots (other bookmarks, etc.)
            if (data.roots.other) {
                createSection("Other Bookmarks", data.roots.other.children);
            }
        });
</script>
</body>
</html>
