<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bookmarks</title>
<style>
  body {
    font-family: sans-serif;
    background: #f5f5f5;
    margin: 0; padding: 20px;
    color: #333;
  }
  .category {
    background: white;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    overflow: hidden;
  }
  .category-header {
    background: #0073e6;
    color: white;
    padding: 10px 15px;
    cursor: pointer;
    font-weight: bold;
    user-select: none;
  }
  .category-header:hover {
    background: #005bb5;
  }
  .bookmarks {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 10px;
    padding: 15px;
  }
  .bookmark {
    background: #fafafa;
    padding: 10px;
    border-radius: 6px;
    text-align: center;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    transition: transform 0.1s ease;
  }
  .bookmark:hover {
    transform: translateY(-3px);
  }
  .bookmark a {
    text-decoration: none;
    color: #0073e6;
    font-weight: bold;
  }
  @media (max-width: 768px) {
    .bookmarks {
      display: none;
    }
    .bookmarks.open {
      display: grid;
    }
  }
</style>
</head>
<body>

<div id="container"></div>

<script>
(async function(){
  const response = await fetch("bookmarks.html");
  const text = await response.text();
  const parser = new DOMParser();
  const doc = parser.parseFromString(text, "text/html");

  const container = document.getElementById("container");
  const savedState = JSON.parse(localStorage.getItem('bookmarkFolders') || '{}');

  function createCategory(title, id) {
    const category = document.createElement("div");
    category.className = "category";
    category.dataset.id = id;

    const header = document.createElement("div");
    header.className = "category-header";
    header.textContent = title;

    const bookmarksDiv = document.createElement("div");
    bookmarksDiv.className = "bookmarks open";

    category.appendChild(header);
    category.appendChild(bookmarksDiv);
    container.appendChild(category);

    header.addEventListener("click", () => {
      if (window.innerWidth <= 768) {
        bookmarksDiv.classList.toggle("open");
        savedState[id] = bookmarksDiv.classList.contains("open");
        localStorage.setItem("bookmarkFolders", JSON.stringify(savedState));
      }
    });

    if (window.innerWidth <= 768) {
      if (savedState[id] === true) bookmarksDiv.classList.add("open");
      else bookmarksDiv.classList.remove("open");
    }

    return bookmarksDiv;
  }

  function processDL(dl, parentCategory = null) {
    // Get all DT children as array
    let dtArray = Array.from(dl.children).filter(el => el.tagName === "DT");

    // Sort so DTs with H3 text "toolbar" (case-insensitive) come first
    dtArray.sort((a, b) => {
      const aH3 = a.querySelector("h3");
      const bH3 = b.querySelector("h3");
      const aText = aH3 ? aH3.textContent.toLowerCase() : "";
      const bText = bH3 ? bH3.textContent.toLowerCase() : "";

      // Put 'toolbar' first
      if (aText === "toolbar" && bText !== "toolbar") return -1;
      if (aText !== "toolbar" && bText === "toolbar") return 1;

      // Otherwise keep original order
      return 0;
    });

    for (const dt of dtArray) {
      const h3 = dt.querySelector("h3");
      const a = dt.querySelector("a");
      const nestedDLInsideDT = dt.querySelector("dl");

      if (h3) {
        const id = h3.textContent.replace(/\s+/g, "_");
        const categoryDiv = createCategory(h3.textContent, id);

        const nextSiblingDL = dt.nextElementSibling;
        if (nextSiblingDL && nextSiblingDL.tagName === "DL") {
          processDL(nextSiblingDL, categoryDiv);
        }
        if (nestedDLInsideDT) {
          processDL(nestedDLInsideDT, categoryDiv);
        }
      }
      else if (a && parentCategory) {
        const div = document.createElement("div");
        div.className = "bookmark";
        const link = document.createElement("a");
        link.href = a.href;
        link.textContent = a.textContent || a.href;
        link.target = "_blank";
        div.appendChild(link);
        parentCategory.appendChild(div);
      }
      else if (nestedDLInsideDT) {
        processDL(nestedDLInsideDT, parentCategory);
      }
    }
  }

  const rootDL = doc.querySelector("dl");
  if (rootDL) processDL(rootDL);

})();
</script>

</body>
</html>
